/*!
 * w-comor-socketio-server v1.0.16
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@hapi/hapi"),require("@hapi/inert"),require("socket.io")):"function"==typeof define&&define.amd?define(["@hapi/hapi","@hapi/inert","socket.io"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-comor-socketio-server"]=e(t["@hapi/hapi"],t["@hapi/inert"],t.socket.io)}(this,(function(t,e,r){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var o=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},i="object"==typeof n&&n&&n.Object===Object&&n,a=i,u="object"==typeof self&&self&&self.Object===Object&&self,c=a||u||Function("return this")(),f=c.Symbol,s=f,l=Object.prototype,p=l.hasOwnProperty,v=l.toString,h=s?s.toStringTag:void 0;var y=function(t){var e=p.call(t,h),r=t[h];try{t[h]=void 0;var n=!0}catch(t){}var o=v.call(t);return n&&(e?t[h]=r:delete t[h]),o},b=Object.prototype.toString;var d=y,_=function(t){return b.call(t)},g=f?f.toStringTag:void 0;var j=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":g&&g in Object(t)?d(t):_(t)};var w=function(t){return null!=t&&"object"==typeof t},O=j,m=w;var S=function(t){return m(t)&&"[object Arguments]"==O(t)},A=w,z=Object.prototype,k=z.hasOwnProperty,x=z.propertyIsEnumerable,P=S(function(){return arguments}())?S:function(t){return A(t)&&k.call(t,"callee")&&!x.call(t,"callee")},T=P,$=Array.isArray,E={};var F=function(){return!1};!function(t,e){var r=c,n=F,o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=(a?a.isBuffer:void 0)||n;t.exports=u}({get exports(){return E},set exports(t){E=t}},E);var N=/^(?:0|[1-9]\d*)$/;var C=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&N.test(t))&&t>-1&&t%1==0&&t<e};var I=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},M=j,B=I,U=w,D={};D["[object Float32Array]"]=D["[object Float64Array]"]=D["[object Int8Array]"]=D["[object Int16Array]"]=D["[object Int32Array]"]=D["[object Uint8Array]"]=D["[object Uint8ClampedArray]"]=D["[object Uint16Array]"]=D["[object Uint32Array]"]=!0,D["[object Arguments]"]=D["[object Array]"]=D["[object ArrayBuffer]"]=D["[object Boolean]"]=D["[object DataView]"]=D["[object Date]"]=D["[object Error]"]=D["[object Function]"]=D["[object Map]"]=D["[object Number]"]=D["[object Object]"]=D["[object RegExp]"]=D["[object Set]"]=D["[object String]"]=D["[object WeakMap]"]=!1;var q=function(t){return U(t)&&B(t.length)&&!!D[M(t)]};var L=function(t){return function(e){return t(e)}},G={};!function(t,e){var r=i,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,a=o&&o.exports===n&&r.process,u=function(){try{var t=o&&o.require&&o.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u}({get exports(){return G},set exports(t){G=t}},G);var R=q,V=L,H=G&&G.isTypedArray,W=H?V(H):R,J=o,K=T,Q=$,X=E,Y=C,Z=W,tt=Object.prototype.hasOwnProperty;var et=function(t,e){var r=Q(t),n=!r&&K(t),o=!r&&!n&&X(t),i=!r&&!n&&!o&&Z(t),a=r||n||o||i,u=a?J(t.length,String):[],c=u.length;for(var f in t)!e&&!tt.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Y(f,c))||u.push(f);return u},rt=Object.prototype;var nt=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||rt)};var ot=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),it=nt,at=ot,ut=Object.prototype.hasOwnProperty;var ct=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},ft=j,st=ct;var lt=function(t){if(!st(t))return!1;var e=ft(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},pt=lt,vt=I;var ht=et,yt=function(t){if(!it(t))return at(t);var e=[];for(var r in Object(t))ut.call(t,r)&&"constructor"!=r&&e.push(r);return e},bt=function(t){return null!=t&&vt(t.length)&&!pt(t)};var dt=function(t){return bt(t)?ht(t):yt(t)},_t=j,gt=w;var jt=function(t){return"symbol"==typeof t||gt(t)&&"[object Symbol]"==_t(t)},wt=$,Ot=jt,mt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,St=/^\w*$/;var At,zt=function(t,e){if(wt(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Ot(t))||(St.test(t)||!mt.test(t)||null!=e&&t in Object(e))},kt=c["__core-js_shared__"],xt=(At=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||""))?"Symbol(src)_1."+At:"";var Pt=function(t){return!!xt&&xt in t},Tt=Function.prototype.toString;var $t=function(t){if(null!=t){try{return Tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Et=lt,Ft=Pt,Nt=ct,Ct=$t,It=/^\[object .+?Constructor\]$/,Mt=Function.prototype,Bt=Object.prototype,Ut=Mt.toString,Dt=Bt.hasOwnProperty,qt=RegExp("^"+Ut.call(Dt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Lt=function(t){return!(!Nt(t)||Ft(t))&&(Et(t)?qt:It).test(Ct(t))},Gt=function(t,e){return null==t?void 0:t[e]};var Rt=function(t,e){var r=Gt(t,e);return Lt(r)?r:void 0},Vt=Rt(Object,"create"),Ht=Vt;var Wt=function(){this.__data__=Ht?Ht(null):{},this.size=0};var Jt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Kt=Vt,Qt=Object.prototype.hasOwnProperty;var Xt=function(t){var e=this.__data__;if(Kt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Qt.call(e,t)?e[t]:void 0},Yt=Vt,Zt=Object.prototype.hasOwnProperty;var te=Vt;var ee=Wt,re=Jt,ne=Xt,oe=function(t){var e=this.__data__;return Yt?void 0!==e[t]:Zt.call(e,t)},ie=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=te&&void 0===e?"__lodash_hash_undefined__":e,this};function ae(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=ee,ae.prototype.delete=re,ae.prototype.get=ne,ae.prototype.has=oe,ae.prototype.set=ie;var ue=ae;var ce=function(){this.__data__=[],this.size=0};var fe=function(t,e){return t===e||t!=t&&e!=e},se=fe;var le=function(t,e){for(var r=t.length;r--;)if(se(t[r][0],e))return r;return-1},pe=le,ve=Array.prototype.splice;var he=le;var ye=le;var be=le;var de=ce,_e=function(t){var e=this.__data__,r=pe(e,t);return!(r<0)&&(r==e.length-1?e.pop():ve.call(e,r,1),--this.size,!0)},ge=function(t){var e=this.__data__,r=he(e,t);return r<0?void 0:e[r][1]},je=function(t){return ye(this.__data__,t)>-1},we=function(t,e){var r=this.__data__,n=be(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Oe(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Oe.prototype.clear=de,Oe.prototype.delete=_e,Oe.prototype.get=ge,Oe.prototype.has=je,Oe.prototype.set=we;var me=Oe,Se=Rt(c,"Map"),Ae=ue,ze=me,ke=Se;var xe=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Pe=function(t,e){var r=t.__data__;return xe(e)?r["string"==typeof e?"string":"hash"]:r.map},Te=Pe;var $e=Pe;var Ee=Pe;var Fe=Pe;var Ne=function(){this.size=0,this.__data__={hash:new Ae,map:new(ke||ze),string:new Ae}},Ce=function(t){var e=Te(this,t).delete(t);return this.size-=e?1:0,e},Ie=function(t){return $e(this,t).get(t)},Me=function(t){return Ee(this,t).has(t)},Be=function(t,e){var r=Fe(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function Ue(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ue.prototype.clear=Ne,Ue.prototype.delete=Ce,Ue.prototype.get=Ie,Ue.prototype.has=Me,Ue.prototype.set=Be;var De=Ue,qe=De;function Le(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(Le.Cache||qe),r}Le.Cache=qe;var Ge=Le;var Re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ve=/\\(\\)?/g,He=function(t){var e=Ge(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Re,(function(t,r,n,o){e.push(n?o.replace(Ve,"$1"):r||t)})),e}));var We=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},Je=$,Ke=jt,Qe=f?f.prototype:void 0,Xe=Qe?Qe.toString:void 0;var Ye=function t(e){if("string"==typeof e)return e;if(Je(e))return We(e,t)+"";if(Ke(e))return Xe?Xe.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},Ze=Ye;var tr=function(t){return null==t?"":Ze(t)},er=$,rr=zt,nr=He,or=tr;var ir=jt;var ar=function(t,e){return er(t)?t:rr(t,e)?[t]:nr(or(t))},ur=function(t){if("string"==typeof t||ir(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var cr=function(t,e){for(var r=0,n=(e=ar(e,t)).length;null!=t&&r<n;)t=t[ur(e[r++])];return r&&r==n?t:void 0};var fr=function(t,e,r){var n=null==t?void 0:cr(t,e);return void 0===n?r:n};function sr(t){return"[object Object]"===Object.prototype.toString.call(t)}function lr(t){return"[object String]"===Object.prototype.toString.call(t)}function pr(t){return!(!lr(t)||""===t)}function vr(t){let e=!1;return pr(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function hr(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}var yr=/\s/;var br=function(t){for(var e=t.length;e--&&yr.test(t.charAt(e)););return e},dr=/^\s+/;var _r=function(t){return t?t.slice(0,br(t)+1).replace(dr,""):t},gr=ct,jr=jt,wr=/^[-+]0x[0-9a-f]+$/i,Or=/^0b[01]+$/i,mr=/^0o[0-7]+$/i,Sr=parseInt;var Ar=function(t){if("number"==typeof t)return t;if(jr(t))return NaN;if(gr(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=gr(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=_r(t);var r=Or.test(t);return r||mr.test(t)?Sr(t.slice(2),r?2:8):wr.test(t)?NaN:+t},zr=Ar,kr=1/0;var xr=function(t){return t?(t=zr(t))===kr||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},Pr=xr;var Tr=function(t){var e=Pr(t),r=e%1;return e==e?r?e-r:e:0},$r=Tr;var Er=function(t){return"number"==typeof t&&t==$r(t)};function Fr(t){if(!vr(t))return 0;return xr(t)}var Nr=Tr,Cr=Ar,Ir=tr,Mr=c.isFinite,Br=Math.min;var Ur=function(t){var e=Math[t];return function(t,r){if(t=Cr(t),(r=null==r?0:Br(Nr(r),292))&&Mr(t)){var n=(Ir(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(Ir(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function Dr(t){if(!vr(t))return 0;t=Fr(t);let e=Ur(t);return"0"===String(e)?0:e}function qr(t){if(!function(t){return!!vr(t)&&(t=Fr(t),Er(t))}(t))return!1;return Dr(t)>0}var Lr=me;var Gr=me,Rr=Se,Vr=De;var Hr=me,Wr=function(){this.__data__=new Lr,this.size=0},Jr=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Kr=function(t){return this.__data__.get(t)},Qr=function(t){return this.__data__.has(t)},Xr=function(t,e){var r=this.__data__;if(r instanceof Gr){var n=r.__data__;if(!Rr||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Vr(n)}return r.set(t,e),this.size=r.size,this};function Yr(t){var e=this.__data__=new Hr(t);this.size=e.size}Yr.prototype.clear=Wr,Yr.prototype.delete=Jr,Yr.prototype.get=Kr,Yr.prototype.has=Qr,Yr.prototype.set=Xr;var Zr=Yr;var tn=De,en=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},rn=function(t){return this.__data__.has(t)};function nn(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new tn;++e<r;)this.add(t[e])}nn.prototype.add=nn.prototype.push=en,nn.prototype.has=rn;var on=nn,an=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},un=function(t,e){return t.has(e)};var cn=function(t,e,r,n,o,i){var a=1&r,u=t.length,c=e.length;if(u!=c&&!(a&&c>u))return!1;var f=i.get(t),s=i.get(e);if(f&&s)return f==e&&s==t;var l=-1,p=!0,v=2&r?new on:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var h=t[l],y=e[l];if(n)var b=a?n(y,h,l,e,t,i):n(h,y,l,t,e,i);if(void 0!==b){if(b)continue;p=!1;break}if(v){if(!an(e,(function(t,e){if(!un(v,e)&&(h===t||o(h,t,r,n,i)))return v.push(e)}))){p=!1;break}}else if(h!==y&&!o(h,y,r,n,i)){p=!1;break}}return i.delete(t),i.delete(e),p};var fn=c.Uint8Array,sn=fe,ln=cn,pn=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r},vn=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},hn=f?f.prototype:void 0,yn=hn?hn.valueOf:void 0;var bn=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new fn(t),new fn(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return sn(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=pn;case"[object Set]":var c=1&n;if(u||(u=vn),t.size!=e.size&&!c)return!1;var f=a.get(t);if(f)return f==e;n|=2,a.set(t,e);var s=ln(u(t),u(e),n,o,i,a);return a.delete(t),s;case"[object Symbol]":if(yn)return yn.call(t)==yn.call(e)}return!1};var dn=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},_n=$;var gn=function(t,e,r){var n=e(t);return _n(t)?n:dn(n,r(t))};var jn=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i},wn=function(){return[]},On=Object.prototype.propertyIsEnumerable,mn=Object.getOwnPropertySymbols,Sn=gn,An=mn?function(t){return null==t?[]:(t=Object(t),jn(mn(t),(function(e){return On.call(t,e)})))}:wn,zn=dt;var kn=function(t){return Sn(t,zn,An)},xn=Object.prototype.hasOwnProperty;var Pn=function(t,e,r,n,o,i){var a=1&r,u=kn(t),c=u.length;if(c!=kn(e).length&&!a)return!1;for(var f=c;f--;){var s=u[f];if(!(a?s in e:xn.call(e,s)))return!1}var l=i.get(t),p=i.get(e);if(l&&p)return l==e&&p==t;var v=!0;i.set(t,e),i.set(e,t);for(var h=a;++f<c;){var y=t[s=u[f]],b=e[s];if(n)var d=a?n(b,y,s,e,t,i):n(y,b,s,t,e,i);if(!(void 0===d?y===b||o(y,b,r,n,i):d)){v=!1;break}h||(h="constructor"==s)}if(v&&!h){var _=t.constructor,g=e.constructor;_==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g||(v=!1)}return i.delete(t),i.delete(e),v},Tn=Rt(c,"DataView"),$n=Se,En=Rt(c,"Promise"),Fn=Rt(c,"Set"),Nn=Rt(c,"WeakMap"),Cn=j,In=$t,Mn="[object Map]",Bn="[object Promise]",Un="[object Set]",Dn="[object WeakMap]",qn="[object DataView]",Ln=In(Tn),Gn=In($n),Rn=In(En),Vn=In(Fn),Hn=In(Nn),Wn=Cn;(Tn&&Wn(new Tn(new ArrayBuffer(1)))!=qn||$n&&Wn(new $n)!=Mn||En&&Wn(En.resolve())!=Bn||Fn&&Wn(new Fn)!=Un||Nn&&Wn(new Nn)!=Dn)&&(Wn=function(t){var e=Cn(t),r="[object Object]"==e?t.constructor:void 0,n=r?In(r):"";if(n)switch(n){case Ln:return qn;case Gn:return Mn;case Rn:return Bn;case Vn:return Un;case Hn:return Dn}return e});var Jn=Zr,Kn=cn,Qn=bn,Xn=Pn,Yn=Wn,Zn=$,to=E,eo=W,ro="[object Arguments]",no="[object Array]",oo="[object Object]",io=Object.prototype.hasOwnProperty;var ao=function(t,e,r,n,o,i){var a=Zn(t),u=Zn(e),c=a?no:Yn(t),f=u?no:Yn(e),s=(c=c==ro?oo:c)==oo,l=(f=f==ro?oo:f)==oo,p=c==f;if(p&&to(t)){if(!to(e))return!1;a=!0,s=!1}if(p&&!s)return i||(i=new Jn),a||eo(t)?Kn(t,e,r,n,o,i):Qn(t,e,c,r,n,o,i);if(!(1&r)){var v=s&&io.call(t,"__wrapped__"),h=l&&io.call(e,"__wrapped__");if(v||h){var y=v?t.value():t,b=h?e.value():e;return i||(i=new Jn),o(y,b,r,n,i)}}return!!p&&(i||(i=new Jn),Xn(t,e,r,n,o,i))},uo=w;var co=function t(e,r,n,o,i){return e===r||(null==e||null==r||!uo(e)&&!uo(r)?e!=e&&r!=r:ao(e,r,n,o,t,i))},fo=co;var so=function(t,e){return fo(t,e)};function lo(t){return"[object Array]"===Object.prototype.toString.call(t)}function po(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(sr(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!lr(t)||""!==t)}(t)||!!function(t){return!!lo(t)&&0===t.length}(t))))}let vo=r.Server;return function(r){let n=fr(r,"port");qr(n)||(n=8080),n=Dr(n);let o=fr(r,"pathPolling"),i=[];var a,u;function c(t){let e=function(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}();return hr(r.authenticate)?r.authenticate(t).then((function(t){e.resolve(t)})):e.resolve(!0),e}let f;u="funcs",sr(a=r)&&(pr(u)||vr(u))&&u in a&&(i=dt(r.funcs)),f=r.serverHapi?r.serverHapi:t.server({port:r.port,routes:{cors:!0}});let s=null,l={};pr(o)&&(l={path:o});try{s=new vo(f.listener,l)}catch(t){return console.log("create SocketIO catch:",t),null}let p=[];s.on("connect",(function(t){async function e(e){let n=fr(e,"token","");if(await c(n)){let t=fr(e,"func",""),o=fr(e,"input");if("getFuncs"===t)hr(r.filterFuncs)&&(i=await r.filterFuncs(n,i)),e.output={sys:"sys",funcs:i};else if(function(t,e){function r(t){return lo(t)?t:[t]}if(po(t))return!1;if(0===(t=r(t)).length)return!1;if(po(t))return!1;if(0===(e=r(e)).length)return!1;for(let r=0;r<t.length;r++)for(let n=0;n<e.length;n++)if(so(t[r],e[n]))return!0;return!1}(i,t)){let n=await r.funcs[t](o);e.output=n}else e.output={err:`can not find: ${t}`}}else e.output={err:`can not authenticate token: ${n}`};delete e.input;try{t.send(JSON.stringify(e),(function(t){t&&console.log("Server: send output error:",t)}))}catch(t){console.log("Server: send output catch:",t)}}p.push(t.id),hr(r.onClientChange)&&r.onClientChange(p,r),t.on("message",(function(t){e(function(t){if(!pr(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(t))})),t.on("disconnect",(function(e){p=p.filter((function(e){return e!==t.id})),hr(r.onClientChange)&&r.onClientChange(p,r)}))})),async function(){if(!r.serverHapi){await f.register(e);let t=[{method:"GET",path:"/web.html",handler:{file:{path:"./web.html"}}},{method:"GET",path:"/dist/w-comor-socketio-client.umd.js",handler:{file:{path:"./dist/w-comor-socketio-client.umd.js"}}},{method:"GET",path:"/dist/w-comor-socketio-client.umd.js.map",handler:{file:{path:"./dist/w-comor-socketio-client.umd.js.map"}}}];f.route(t)}await f.start(),console.log(`Server running at: ${f.info.uri}`)}()}}));
//# sourceMappingURL=w-comor-socketio-server.umd.js.map
